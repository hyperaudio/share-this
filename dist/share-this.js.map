{"version":3,"sources":["share-this.js"],"names":["global","factory","exports","module","define","amd","ShareThis","this","getOffsetScroll","_window","body","document","scrollReference","getComputedStyle","position","parentNode","getBoundingClientRect","matches","element","selector","matchFunc","getMatchFunctionName","closest","target","nodeType","contains","ancestor","comparedPositions","compareDocumentPosition","suffix","_arr","_i","length","name","findByName","array","i","item","extend","dest","source","_typeof","prop","isCallable","func","_toConsumableArray","arr","Array","isArray","arr2","from","isSelectionForward","selection","isCollapsed","anchorNode","focusNode","anchorOffset","focusOffset","getEndLineRect","range","isForward","endLineRects","rangeRects","getClientRects","sliceRects","slice","bind","lastLeft","Infinity","rect","left","lastRight","_rect","right","top","Math","min","apply","map","bottom","max","constrainRange","constrainedRange","cloneRange","collapsed","startContainer","endContainer","setEnd","childNodes","setStart","collapse","stylePopover","popover","options","_document","defaultView","getSelection","endLineRect","offsetScroll","selectorElement","querySelector","style","offset","documentElement","clientWidth","width","height","startTop","_offset","scrollTop","className","popoverClass","popoverClick","sharers","event","dataAttribute","via","getAttribute","sharer","action","lifeCycleFactory","createPopover","createElement","addEventListener","attachPopover","appendChild","removePopover","parent","removeChild","Symbol","iterator","obj","constructor","prototype","render","text","rawText","refUrl","shareUrl","location","call","join","_undefined","eventTypes","core","opts","addListener","type","selectionCheck","removeListener","removeEventListener","resizeHandler","getConstrainedRange","_ref","shouldHavePopover","setTimeout","drawPopover","killPopover","rangeCount","getRangeAt","toBeOpened","toString","transformer","filter","sharerCheck","lifeCycle","innerHTML","onOpen","onClose","active","Object","assign","raw","trim","replace","initialized","destroyed","init","forEach","console","warn","destroy"],"mappings":"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","file":"share-this.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define(factory) :\n    (global.ShareThis = factory());\n}(this, (function () { 'use strict';\n\nfunction getOffsetScroll(_window) {\n    var body = _window.document.body;\n    var scrollReference = _window.getComputedStyle(body).position === \"static\" ? body.parentNode : body;\n    return scrollReference.getBoundingClientRect();\n}\n\nvar matchFunc = void 0;\nfunction matches(element, selector) {\n    if (!matchFunc) matchFunc = getMatchFunctionName(element);\n    return element[matchFunc](selector);\n}\n\nfunction closest(element, selector) {\n    var target = element;\n    while (target && (target.nodeType !== 1 /* === Node.ELEMENT_NODE */ || !matches(target, selector))) {\n        target = target.parentNode;\n    }\n\n    return target;\n}\n\n// `contains` in IE doesn't work with text nodes\nfunction contains(ancestor, target) {\n    var comparedPositions = ancestor.compareDocumentPosition(target);\n    // eslint-disable-next-line no-bitwise\n    return !comparedPositions || (comparedPositions & 16 /* === Node.DOCUMENT_POSITION_CONTAINED_BY */) > 0;\n}\n\n// eslint-disable-next-line consistent-return\nfunction getMatchFunctionName(element) {\n    var suffix = \"atchesSelector\";\n    var _arr = [\"matches\", \"m\" + suffix, \"webkitM\" + suffix, \"mozM\" + suffix, \"msM\" + suffix, \"oM\" + suffix];\n    for (var _i = 0; _i < _arr.length; _i++) {\n        var name = _arr[_i];\n        if (element[name]) return name;\n    }\n}\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n\n\n// eslint-disable-next-line consistent-return\nfunction findByName(array, name) {\n    // I would have used\n    //    for (const item of array) {\n    // but transpilers generate A LOT of code in this specific case.\n    for (var i = 0; i < array.length; i++) {\n        var item = array[i];\n        if (item.name === name) {\n            return item;\n        }\n    }\n}\n\nfunction extend(dest, source) {\n    if (source && (typeof source === \"undefined\" ? \"undefined\" : _typeof(source)) === \"object\") {\n        // eslint-disable-next-line guard-for-in\n        for (var prop in source) {\n            // eslint-disable-next-line no-param-reassign\n            dest[prop] = source[prop];\n        }\n    }\n\n    return dest;\n}\n\nfunction isCallable(func) {\n    return typeof func === \"function\";\n}\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction isSelectionForward(selection) {\n    if (selection.isCollapsed) return true;\n\n    var comparedPositions = selection.anchorNode.compareDocumentPosition(selection.focusNode);\n    if (!comparedPositions) {\n        // It's the same node\n        return selection.anchorOffset < selection.focusOffset;\n    }\n\n    // eslint-disable-next-line no-bitwise\n    return (comparedPositions & 4 /* === Node.DOCUMENT_POSITION_FOLLOWING */) > 0;\n}\n\nfunction getEndLineRect(range, isForward) {\n    var endLineRects = void 0;\n    var rangeRects = range.getClientRects();\n    var sliceRects = [].slice.bind(rangeRects);\n\n    if (isForward) {\n        var lastLeft = Infinity;\n        var i = rangeRects.length;\n        while (i--) {\n            var rect = rangeRects[i];\n            if (rect.left > lastLeft) break;\n            lastLeft = rect.left;\n        }\n        endLineRects = sliceRects(i + 1);\n    } else {\n        var lastRight = -Infinity;\n        var _i = 0;\n        for (; _i < rangeRects.length; _i++) {\n            var _rect = rangeRects[_i];\n            if (_rect.right < lastRight) break;\n            lastRight = _rect.right;\n        }\n        endLineRects = sliceRects(0, _i);\n    }\n\n    return {\n        top: Math.min.apply(Math, _toConsumableArray(endLineRects.map(function (rect) {\n            return rect.top;\n        }))),\n        bottom: Math.max.apply(Math, _toConsumableArray(endLineRects.map(function (rect) {\n            return rect.bottom;\n        }))),\n        left: endLineRects[0].left,\n        right: endLineRects[endLineRects.length - 1].right\n    };\n}\n\nfunction constrainRange(range, selector) {\n    var constrainedRange = range.cloneRange();\n    if (range.collapsed || !selector) return constrainedRange;\n\n    var ancestor = closest(range.startContainer, selector);\n    if (ancestor) {\n        if (!contains(ancestor, range.endContainer)) {\n            constrainedRange.setEnd(ancestor, ancestor.childNodes.length);\n        }\n    } else {\n        ancestor = closest(range.endContainer, selector);\n        if (ancestor) constrainedRange.setStart(ancestor, 0);else constrainedRange.collapse();\n    }\n\n    return constrainedRange;\n}\n\nfunction stylePopover(popover, range, options) {\n    var _document = options.document;\n    var _window = _document.defaultView;\n    var selection = _window.getSelection();\n    var isForward = isSelectionForward(selection);\n    var endLineRect = getEndLineRect(range, isForward);\n    var offsetScroll = getOffsetScroll(_window);\n    var selectorElement = document.querySelector(options.selector);\n\n    var style = popover.style;\n    if (isForward) {\n        var offset = endLineRect.right + offsetScroll.left;\n        style.right = _document.documentElement.clientWidth - offset + \"px\";\n    } else {\n        style.left = endLineRect.left - offsetScroll.left + \"px\";\n    }\n    style.width = endLineRect.right - endLineRect.left + \"px\";\n    style.height = endLineRect.bottom - endLineRect.top + \"px\";\n    style.top = endLineRect.top - offsetScroll.top + \"px\";\n\n    var startTop = endLineRect.top - offsetScroll.top;\n\n    if (selectorElement) {\n        var _offset = selectorElement.scrollTop - selectorElement.getBoundingClientRect().top;\n        _offset += offsetScroll.top;\n        style.top = startTop + _offset + \"px\";\n    } else {\n        style.top = startTop + \"px\";\n    }\n\n    style.position = \"absolute\";\n\n    // eslint-disable-next-line no-param-reassign\n    popover.className = options.popoverClass;\n}\n\nvar dataAttribute = \"data-share-via\";\nfunction popoverClick(sharers, event) {\n    var item = closest(event.target, \"[\" + dataAttribute + \"]\");\n    if (!item) return;\n\n    var via = item.getAttribute(dataAttribute);\n    var sharer = findByName(sharers, via);\n    if (sharer && isCallable(sharer.action)) {\n        sharer.action(event, item);\n    }\n}\n\nfunction lifeCycleFactory(document, options) {\n    return {\n        createPopover: function createPopover() {\n            var popover = document.createElement(\"div\");\n            popover.addEventListener(\"click\", function (event) {\n                popoverClick(this.sharers, event);\n            });\n            return popover;\n        },\n        attachPopover: function attachPopover(popover) {\n            var selectorElement = document.querySelector(options.selector);\n\n            if (selectorElement) {\n                selectorElement.appendChild(popover);\n            } else {\n                document.body.appendChild(popover);\n            }\n        },\n        removePopover: function removePopover(popover) {\n            var parent = popover.parentNode;\n            if (parent) parent.removeChild(popover);\n        }\n    };\n}\n\nvar render = (function (options, sharers, text, rawText) {\n    var refUrl = options.shareUrl || options.document.defaultView.location;\n\n    // eslint-disable-next-line prefer-template\n    return \"<ul>\" + sharers.map(function (sharer) {\n        return \"<li data-share-via=\\\"\" + sharer.name + \"\\\">\" + sharer.render.call(sharer, text, rawText, refUrl) + \"</li>\";\n    }).join(\"\") + \"</ul>\";\n});\n\nvar _undefined = void 0;\nvar eventTypes = [\"selectionchange\", \"mouseup\", \"touchend\", \"touchcancel\"];\n\nvar core = (function (opts) {\n    var options = (Object.assign || extend)({\n        document: document,\n        selector: \"body\",\n        sharers: [],\n        popoverClass: \"share-this-popover\",\n        transformer: function transformer(raw) {\n            return raw.trim().replace(/\\s+/g, \" \");\n        }\n    }, opts || {});\n\n    var initialized = false;\n    var destroyed = false;\n\n    var _document = _undefined;\n    var _window = _undefined;\n\n    var popover = _undefined;\n    var lifeCycle = _undefined;\n\n    return {\n        init: function init() {\n            if (initialized) return false;\n\n            _document = options.document;\n            _window = _document.defaultView;\n            if (!_window.getSelection) {\n                // eslint-disable-next-line no-console\n                console.warn(\"share-this: Selection API isn't supported\");\n                return false;\n            }\n\n            eventTypes.forEach(addListener);\n            _window.addEventListener(\"resize\", resizeHandler);\n\n            lifeCycle = lifeCycleFactory(_document, options);\n\n            return initialized = true;\n        },\n        destroy: function destroy() {\n            if (!initialized || destroyed) return false;\n\n            eventTypes.forEach(removeListener);\n            _window.removeEventListener(\"resize\", resizeHandler);\n\n            killPopover();\n\n            _document = _undefined;\n            _window = _undefined;\n\n            return destroyed = true;\n        }\n    };\n\n    function addListener(type) {\n        _document.addEventListener(type, selectionCheck);\n    }\n    function removeListener(type) {\n        _document.removeEventListener(type, selectionCheck);\n    }\n    function resizeHandler() {\n        if (popover) {\n            stylePopover(popover, getConstrainedRange(), options);\n        }\n    }\n\n    function selectionCheck(_ref) {\n        var type = _ref.type;\n\n        var shouldHavePopover = type === \"selectionchange\";\n        if (!popover !== shouldHavePopover) {\n            // Safari iOS fires selectionchange *before* click, so tapping on a sharer would be prevented\n            setTimeout(function () {\n                var range = getConstrainedRange();\n                if (range) drawPopover(range);else killPopover();\n            }, 10);\n        }\n    }\n\n    function getConstrainedRange() {\n        var selection = _window.getSelection();\n        var range = selection.rangeCount && selection.getRangeAt(0);\n        if (!range) return;\n\n        var constrainedRange = constrainRange(range, options.selector);\n        if (constrainedRange.collapsed || !constrainedRange.getClientRects().length) return;\n\n        // eslint-disable-next-line consistent-return\n        return constrainedRange;\n    }\n\n    function drawPopover(range) {\n        var toBeOpened = !popover;\n        var rawText = range.toString();\n        var text = options.transformer(rawText);\n        var sharers = options.sharers.filter(sharerCheck.bind(null, text, rawText));\n\n        if (!sharers.length) {\n            if (popover) killPopover();\n            return;\n        }\n        if (toBeOpened) popover = lifeCycle.createPopover();\n\n        popover.sharers = sharers;\n        popover.innerHTML = render(options, sharers, text, rawText);\n        stylePopover(popover, range, options);\n\n        if (!toBeOpened) return;\n\n        lifeCycle.attachPopover(popover);\n\n        if (isCallable(options.onOpen)) {\n            options.onOpen(popover, text, rawText);\n        }\n    }\n\n    function killPopover() {\n        if (!popover) return;\n\n        lifeCycle.removePopover(popover);\n        popover = _undefined;\n        if (isCallable(options.onClose)) {\n            options.onClose();\n        }\n    }\n\n    function sharerCheck(text, rawText, sharer) {\n        var active = sharer.active;\n        if (isCallable(active)) {\n            return active(text, rawText);\n        }\n\n        if (active !== _undefined) {\n            return active;\n        }\n\n        return true;\n    }\n});\n\nreturn core;\n\n})));\n"]}